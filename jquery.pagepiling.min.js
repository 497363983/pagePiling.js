/* ===========================================================
 * pagepiling.js 0.0.4 (Beta)
 *
 * https://github.com/alvarotrigo/pagePiling.js
 * MIT licensed
 *
 * Copyright (C) 2014 alvarotrigo.com - A project by Alvaro Trigo
 *
 * ========================================================== */

!function(n){n.fn.pagepiling=function(e){function t(n){n.addClass("pp-table").wrapInner('<div class="pp-tableCell" style="height:100%" />')}function o(){var e=destination.index(".pp-section");return n(".pp-section.active").index(".pp-section")<e?"down":"up"}function i(t,i){var c=n(".pp-section.active"),s=t.data("anchor"),r=t.index(".pp-section"),l=o(t),d=c.index(".pp-section")+1;if(void 0===i&&(i=!0),void 0!==s&&a(s),t.addClass("active").siblings().removeClass("active"),c.index(".pp-section")<r){if("vertical"===e.direction)var u="translate3d(0px, -100%, 0px)";else var u="translate3d(-100%, 0px, 0px)";var v="-100%",f=n(".pp-section").map(function(e){return e<t.index(".pp-section")?n(this):void 0});e.css3||f.each(function(t){t!=c.index(".pp-section")&&n(this).css("vertical"===e.direction?{top:v}:{left:v})});var h=c,g=function(){}}else var u="translate3d(0px, 0px, 0px)",v="0",f=n(".pp-section").map(function(e){return e>t.index(".pp-section")?n(this):void 0}),h=t,g=function(){f.each(function(){n(this).css("vertical"===e.direction?{top:v}:{left:v})})};var m=function(){n.isFunction(e.afterLoad)&&e.afterLoad.call(this,s,r+1)};n.isFunction(e.onLeave)&&e.onLeave.call(this,d,r+1,l),e.css3?(p(h,u,i),f.each(function(){p(n(this),u,i)}),setTimeout(function(){m()},e.scrollingSpeed)):"vertical"===e.direction?i?h.animate({top:v},e.scrollingSpeed,e.easing,function(){g(),m()}):(h.css("top",v),setTimeout(function(){g(),m()},400)):i?h.animate({left:v},e.scrollingSpeed,e.easing,function(){g(),m()}):(h.css("left",v),setTimeout(function(){g(),m()},400)),T(s),M(s,r),k=s;var S=(new Date).getTime();L=S}function a(n){e.anchors.length&&(location.hash=n)}function c(){var t=window.location.hash.replace("#",""),o=t,a=n('.pp-section[data-anchor="'+o+'"]');a.length>0&&i(a,e.animateAnchor)}function s(){var n=(new Date).getTime();return n-L<D+e.scrollingSpeed?!0:!1}function r(){var e=window.location.hash.replace("#","").split("/"),t=e[0];if(t.length){if(t&&t!==k){if(isNaN(t))var o=n('[data-anchor="'+t+'"]');else var o=n(".pp-section").eq(t-1);i(o)}}}function l(n){return{"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n,transform:n}}function p(n,e,t){n.toggleClass("pp-easing",t),n.css(l(e))}function d(e){if(!s()){e=window.event||e;var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.deltaY||-e.detail)),o=n(".pp-section.active"),i=v(o);return 0>t?u("down",i):u("up",i),!1}}function u(e,t){if("down"==e)var o="bottom",i=n.fn.pagepiling.moveSectionDown;else var o="top",i=n.fn.pagepiling.moveSectionUp;if(t.length>0){if(!isScrolled(o,t))return!0;i()}else i()}function v(n){return scrollable=n.find(".pp-scrollable")}function o(e){var t=n(".pp-section.active").index(".pp-section"),o=e.index(".pp-section");return t>o?"up":"down"}function f(){P.get(0).addEventListener?(P.get(0).removeEventListener("mousewheel",d,!1),P.get(0).removeEventListener("wheel",d,!1)):P.get(0).detachEvent("onmousewheel",d)}function h(){P.get(0).addEventListener?(P.get(0).addEventListener("mousewheel",d,!1),P.get(0).addEventListener("wheel",d,!1)):P.get(0).attachEvent("onmousewheel",d)}function g(){Y&&(MSPointer=S(),P.off("touchstart "+MSPointer.down).on("touchstart "+MSPointer.down,x),P.off("touchmove "+MSPointer.move).on("touchmove "+MSPointer.move,b))}function m(){Y&&(MSPointer=S(),P.off("touchstart "+MSPointer.down),P.off("touchmove "+MSPointer.move))}function S(){var n;return n=window.PointerEvent?{down:"pointerdown",move:"pointermove",up:"pointerup"}:{down:"MSPointerDown",move:"MSPointerMove",up:"MSPointerUp"}}function w(n){var e=[];return window.navigator.msPointerEnabled?(e.y=n.pageY,e.x=n.pageX):(e.y=n.touches[0].pageY,e.x=n.touches[0].pageX),e}function x(n){var e=n.originalEvent,t=w(e);touchStartY=t.y}function b(t){var o=t.originalEvent;if(!E(t.target)){t.preventDefault();var i=n(".pp-section.active"),a=v(i);if(!s()){var c=w(o);touchEndY=c.y,touchEndX=c.x,Math.abs(touchStartY-touchEndY)>P.height()/100*e.touchSensitivity&&(touchStartY>touchEndY?u("down",a):touchEndY>touchStartY&&u("up",a))}}}function E(t,o){o=o||0;var i=n(t).parent();return o<e.normalScrollElementTouchThreshold&&i.is(e.normalScrollElements)?!0:o==e.normalScrollElementTouchThreshold?!1:E(i,++o)}function C(){n("body").append('<div id="pp-nav"><ul></ul></div>');var t=n("#pp-nav");t.css("color",e.navigation.textColor),t.addClass(e.navigation.position);for(var o=0;o<n(".pp-section").length;o++){var i="";if(e.anchors.length&&(i=e.anchors[o]),void 0!==e.navigation.tooltips){var a=e.navigation.tooltips[o];void 0===a&&(a="")}t.find("ul").append('<li data-tooltip="'+a+'"><a href="#'+i+'"><span></span></a></li>')}t.find("span").css("border-color",e.navigation.bulletsColor)}function M(t,o){e.navigation&&(n("#pp-nav").find(".active").removeClass("active"),t?n("#pp-nav").find('a[href="#'+t+'"]').addClass("active"):n("#pp-nav").find("li").eq(o).find("a").addClass("active"))}function T(t){e.menu&&(n(e.menu).find(".active").removeClass("active"),n(e.menu).find('[data-menuanchor="'+t+'"]').addClass("active"))}function y(){var n,e=document.createElement("p"),t={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var o in t)void 0!==e.style[o]&&(e.style[o]="translate3d(1px,1px,1px)",n=window.getComputedStyle(e).getPropertyValue(t[o]));return document.body.removeChild(e),void 0!==n&&n.length>0&&"none"!==n}var k,P=n(this),L=0,Y="ontouchstart"in window||navigator.msMaxTouchPoints>0,D=600;e=n.extend({direction:"vertical",menu:null,verticalCentered:!0,sectionsColor:[],anchors:[],scrollingSpeed:700,easing:"swing",loopBottom:!1,loopTop:!1,css3:!0,navigation:{textColor:"#000",bulletsColor:"#000",position:"right",tooltips:["section1","section2","section3","section4"]},normalScrollElements:null,normalScrollElementTouchThreshold:5,touchSensitivity:5,keyboardScrolling:!0,sectionSelector:".section",animateAnchor:!1,afterLoad:null,onLeave:null,afterRender:null},e),n.fn.pagepiling.setScrollingSpeed=function(n){e.scrollingSpeed=n},n.fn.pagepiling.setMouseWheelScrolling=function(n){n?h():f()},n.fn.pagepiling.setAllowScrolling=function(e){e?(n.fn.pagepiling.setMouseWheelScrolling(!0),g()):(n.fn.pagepiling.setMouseWheelScrolling(!1),m())},n.fn.pagepiling.setKeyboardScrolling=function(n){e.keyboardScrolling=n},n.fn.pagepiling.moveSectionUp=function(){var t=n(".pp-section.active").prev(".pp-section");!t.length&&e.loopTop&&(t=n(".pp-section").last()),t.length&&i(t)},n.fn.pagepiling.moveSectionDown=function(){var t=n(".pp-section.active").next(".pp-section");!t.length&&e.loopBottom&&(t=n(".pp-section").first()),t.length&&i(t)},n.fn.pagepiling.moveTo=function(e){var t="";t=isNaN(e)?n('[data-anchor="'+e+'"]'):n(".pp-section").eq(e-1),t.length>0&&i(t)},n(e.sectionSelector).each(function(){n(this).addClass("pp-section")}),e.css3&&(e.css3=y()),n(P).css({overflow:"hidden","-ms-touch-action":"none","touch-action":"none"}),n.fn.pagepiling.setAllowScrolling(!0),n.isEmptyObject(e.navigation)||C();var q=n(".pp-section").length;n(".pp-section").each(function(o){n(this).data("data-index",o),n(this).css("z-index",q),o||0!==n(".pp-section.active").length||n(this).addClass("active"),void 0!==e.anchors[o]&&n(this).attr("data-anchor",e.anchors[o]),void 0!==e.sectionsColor[o]&&n(this).css("background-color",e.sectionsColor[o]),e.verticalCentered&&t(n(this)),q-=1}).promise().done(function(){e.navigation&&(n("#pp-nav").css("margin-top","-"+n("#pp-nav").height()/2+"px"),n("#pp-nav").find("li").eq(n(".pp-section.active").index(".pp-section")).find("a").addClass("active")),n(window).on("load",function(){c()}),n.isFunction(e.afterRender)&&e.afterRender.call(this)}),n(window).on("hashchange",r),n(document).keydown(function(t){if(e.keyboardScrolling&&!s())switch(t.which){case 38:case 33:n.fn.pagepiling.moveSectionUp();break;case 40:case 34:n.fn.pagepiling.moveSectionDown();break;case 36:n.fn.pagepiling.moveTo(1);break;case 35:n.fn.pagepiling.moveTo(n(".pp-section").length);break;case 37:n.fn.pagepiling.moveSectionUp();break;case 39:n.fn.pagepiling.moveSectionDown();break;default:return}}),e.normalScrollElements&&(n(document).on("mouseenter",e.normalScrollElements,function(){n.fn.pagepiling.setMouseWheelScrolling(!1)}),n(document).on("mouseleave",e.normalScrollElements,function(){n.fn.pagepiling.setMouseWheelScrolling(!0)})),n(document).on("click touchstart","#pp-nav a",function(e){e.preventDefault();var t=n(this).parent().index();i(n(".pp-section").eq(t))}),n(document).on({mouseenter:function(){var t=n(this).data("tooltip");n('<div class="pp-tooltip '+e.navigation.position+'">'+t+"</div>").hide().appendTo(n(this)).fadeIn(200)},mouseleave:function(){n(this).find(".pp-tooltip").fadeOut(200,function(){n(this).remove()})}},"#pp-nav li")}}(jQuery);